/* Copyright (c) 2023, Canaan Bright Sight Co., Ltd
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 1. Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 * notice, this list of conditions and the following disclaimer in the
 * documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
 * CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <linux/if_alg.h>

// #define _debug
#define AES_TEST_LEN 4096

typedef enum {
    RSA1024,      ///< RSA-1024
    RSA2048,      ///< RSA-2048
    RSA3072,      ///< RSA-3072
    RSA4096,      ///< RSA-4096
    N_RSA_TYPE_T, // keep in the last one
} rsa_type_t;

static const struct rsa_test_pattern
{
    rsa_type_t rsatype;
    uint32_t e;
    const void* n;
    const void* d;
    const void* m;
    const void* s;
} rsa_tp[] =
{
    { RSA1024, 0x10001,
        "\xbb\x57\x84\x79\x4f\x27\xbf\xab\x90\xa1\x9b\xcc\x20\xbb\x10\xac\x3d\x1d\x43\x2d\x90\x65\x1d\xac\xe6\x23\x5e\x34\x56\x0a\xbd\x73\x3a\x0c\x3b\x69\x3e\xa3\x80\x27\x07\xc0\xe2\x2e\x81\x60\x3a\x6e\x2b\x82\x81\x2a\x00\x27\xec\xe2\xd9\x74\xa5\xa5\x19\x0d\xf8\x9d\x63\x6f\x7a\xb2\x00\x84\x90\x65\xfe\x41\x2f\xe8\x5e\x41\xac\xeb\x0d\x68\xb1\x0c\xdd\x07\xe4\x2e\xa1\x61\x84\xc9\x74\xf5\x8c\x10\xc5\x60\xaa\x44\x4f\x64\xb4\x1e\x93\x2a\xb2\x53\x55\x64\x8b\x51\x0b\x1f\xee\xdc\xa7\x80\xcf\xb6\x8f\x11\xac\x9f\xc9\x8a\xb1\x5b",
        "\x55\x72\x63\xea\x3e\x97\xb7\x1c\xe5\xf1\x48\x11\xb1\x26\x11\x43\x35\xf6\xb8\x52\xba\x66\xdc\x43\xa5\x8e\x21\x24\x06\xd0\x8c\x3b\x57\x91\x07\xb2\x07\x8f\x64\x5e\xa8\xf3\x29\x56\xa3\xcc\xc3\xa9\xc7\x2f\x95\x81\x16\x24\x1f\xb0\x12\x15\xd9\x8d\x75\x61\x81\x70\x61\xf6\xfc\x60\x01\xf4\x23\x71\x2f\x81\x5f\x1c\xaf\x32\x5b\xf9\x24\x05\xda\x86\x70\xc8\xac\x1b\x93\x18\x13\x40\x2d\xe1\x41\x1c\x3e\x2b\x0c\x57\x6a\x94\x37\x8b\x5c\xcf\x54\x0f\x95\xd6\x24\x00\xb9\x61\x0e\x83\x19\x0f\xb2\xb8\xdb\xf1\x3e\x83\x8b\x9f\x86\xed",
        "\x4f\x9b\xc8\xbd\x93\x6c\x03\xef\xd4\xe5\xe0\x10\x64\xff\x54\xf0\x81\x61\x87\x71\xd4\xa9\x61\xf1\x2a\x67\xa2\x78\x9a\x4f\x01\xb7\x7e\x50\x7f\xad\x82\xe7\xc4\x6b\x4c\x05\x26\x72\xc5\xa4\x7e\xb2\x6f\xc6\xc5\x6e\x44\x6c\x31\x27\x1d\xb8\xe9\xe9\x5d\x53\x34\xaa\xfe\x21\xf7\x9c\xe9\x35\xee\xbd\x1f\xb4\x01\xb7\x80\x4d\xa0\x31\x5e\x8a\xb5\x07\x49\x91\xc7\xb3\x26\x96\xa5\xd2\x66\xc9\x1a\xa2\x28\x05\xfd\x45\x88\xb7\x40\x20\x14\xaa\x00\x56\x70\x4d\x63\x11\xa3\xe2\x77\xed\x67\x7b\xb2\xcc\xd2\x2c\x44\x45\x3b\x9d\x7b\x8f",
        "\x0c\x07\xb7\x0a\x40\xe0\xf6\xc3\x94\x3c\x21\xbe\x95\x5e\x19\x6b\x09\x53\x9b\x3f\x53\x11\x64\xe5\x3c\x15\x8a\x62\x80\x93\xdb\xdf\x11\xea\xc6\x9e\x70\xa4\xcc\x3e\x32\x35\x2f\x75\x70\x1e\xd1\xbb\x0a\xfd\x68\xf6\x28\x37\x4e\x65\x8c\x9a\x40\x41\xee\x78\x13\xa9\xe5\x69\x47\x43\xa1\x76\x32\x0d\xcc\xf1\xe4\xc3\x6a\xb7\x17\xe6\xcc\x89\xbc\x62\x85\xa2\x3c\x1a\xfc\xd9\xdd\x31\x23\x27\x91\xe1\x9a\xb2\xf5\x9c\x1f\xf0\x90\x52\xf4\x59\xfc\x03\x42\xaa\xc1\x53\xaa\x0b\x06\x31\x29\xd9\xad\xff\x92\x04\x4f\x63\xd5\x09\x89\x9f",
    },
    { RSA2048, 0x10001,
        "\xbc\xf4\x2a\xb8\xac\x55\x2f\x8c\x57\xe1\xbb\x27\xc4\x66\xd5\xc8\x2d\x3f\x72\x0d\x48\xdd\x10\xfc\xd4\x36\xb5\x05\x31\xde\xd6\x14\x8d\xb6\x02\xfb\x95\x27\xdd\x16\x04\x10\x6f\xfc\xe3\xef\x24\xc8\xbf\xff\x2a\x63\x2a\x10\x6b\x15\x8c\x57\x77\x36\x36\x98\x97\x51\x8f\xa2\x65\xa9\x2c\x60\xe0\xf4\x67\xd8\xaa\x67\x57\x36\x24\x00\x0c\x52\xe8\xe0\x7b\xc9\xd8\x97\x76\x92\xe1\x55\x19\x24\x91\x9f\x0c\x1c\x42\x82\xc2\x48\x1e\xc0\x8c\xe1\x69\x1e\xf9\x13\x83\xbe\xbe\x7c\xfa\xe2\x89\x5a\x43\x2b\xbd\xd8\xf6\xb5\x96\x55\xb7\x04\x00\x32\xc3\x84\xc1\x9e\xba\x91\x50\x03\xa7\x5d\xcb\x1b\xf5\x74\x4a\x1f\x65\x27\xaa\xb1\x4e\xd4\x22\xe8\x40\x87\x63\xdb\x6f\x23\xff\x54\x67\x2d\x9d\xd3\xf5\x5f\xb6\x5c\xb5\x67\xee\x65\x15\x1d\x67\xbf\x29\x08\xe1\xa6\x0b\xcf\x1d\x4a\x78\x2e\x89\x60\xc7\xdb\x80\xff\xca\xaa\x56\x0d\xbf\xdb\x36\x14\xda\x8f\x85\xfa\x06\x11\xc7\xf3\x30\x7d\xfa\x1b\xfa\x5a\x3c\xf6\x9c\xb8\x01\xd2\x93\xe4\xb0\xe3\x4b\x4e\xc6\x12\x23\x93\x0f\xc7\x45\x61\x44\xa5\x1e\xfe\x0c\x3c\xa6\x7b\xc2\xae\xf7\xf9\x5e\xaf\x87\x0d\x63\x70\x73\x59",
        "\x53\x13\xad\x86\xe5\xaa\x4c\x8e\x11\x83\x9b\x84\x78\x0b\x58\xba\x3a\xfe\xb6\xb8\x15\x8d\xb0\xee\xe0\xa5\x2f\x00\xda\x34\xe5\xfe\x42\x72\x40\xac\x79\x9f\x7d\xca\xb4\xbd\xbf\x67\x3a\x96\x46\x1f\x87\x9e\xfa\x75\x80\x24\x98\xd8\x70\x0c\x72\xcb\x20\xc5\x05\x5e\xe4\x5e\x9c\x00\xfe\x14\x98\x43\x8d\x37\x0b\x71\x05\x3c\xb6\x26\x59\x44\xc8\xc4\x0e\x59\x28\x44\x2b\xeb\x97\x6c\x11\x72\x6d\x1e\x37\x36\x63\x9d\xd7\x2a\xdb\x6e\x80\x62\x89\x14\x07\xa2\x27\x5e\x21\xa5\x94\xaf\x2e\x81\xc3\x9f\xc3\x48\x55\xec\x6f\xed\x3e\xda\x1f\x8b\x8a\xc8\xc8\x07\xe5\xb5\xd7\xd9\x83\xd9\x4e\x0b\x83\x56\x6c\xdf\xde\xf9\x64\x0d\xb4\xe2\x57\x28\x11\x59\x0c\xd8\x97\x7f\xd6\xf3\xc2\x6d\xb8\xd4\x57\xb3\xc6\x64\xf1\x3b\x52\x16\x30\xcd\xbd\x49\xbb\x27\xaa\x8c\xd3\x19\x29\xf1\x66\x81\xbe\xc7\x59\x2d\xee\xfc\x0c\x2c\x84\x00\x1c\xa4\xf9\xd1\xc1\x92\xc1\x3e\x8d\xb6\xe4\x4e\x47\x55\x7d\x4b\x7f\x53\xdd\xb4\x88\xd3\x89\xed\x08\x4b\x20\xdd\xc3\xf7\x52\x36\x7e\xaa\x28\x24\x20\x96\x87\xf9\x24\x87\x91\x4a\xe7\x77\xb0\x92\xe5\x8a\x09\xb0\x04\x1d\xd0\xfa\x49\xeb",
        "\x6b\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xba\xe4\xbb\xd0\xc3\x64\x6c\x7f\x04\xd5\x35\x5c\x5a\x10\x36\x28\xff\x3f\x06\xbe\x66\x85\x03\xf0\x29\x89\xf7\xe9\x16\x93\xaa\xcf\xe8\xe1\x1c\x9f\xdf\xc3\x17\x64\x2f\x80\xa3\x55\x19\xc8\x90\x46\x84\x04\x81\xfc\x27\x97\x91\x41\x6b\x70\x71\x3f\xca\xe1\x79\xf5\x35\x35\xcc",
        "\x1c\x3f\x6d\xae\x4a\xa8\x07\x81\x2b\xe6\xf7\x3b\xb2\x92\x44\x62\x78\xa1\x45\x77\x28\x42\x1d\x99\xc5\xe9\x1a\x94\x51\xcf\xb3\xe2\x00\x83\xf4\x74\xdc\xd3\x23\x6d\x0b\x28\xf3\x15\x18\x80\x9d\x52\x7f\xb6\x5d\xe0\x1f\x78\x53\xe9\x95\x15\x59\xda\xb9\x82\x18\x61\xfa\x4b\x78\x21\x00\x73\xc6\x39\x27\x9f\x38\x34\x24\x29\x5e\xe3\x15\xd8\xa6\x8e\xe3\xe0\x78\xbe\xc4\x20\x20\xcd\x02\x47\xe3\x8f\xac\x0f\xd3\x8f\x4b\xae\x7d\xc6\x3c\x48\x17\xf2\x7d\xcb\xd7\x23\xd3\x4c\xe0\x85\x2b\x32\x88\xc6\x6a\x25\xeb\xa6\x25\x0c\x9c\x05\xd3\xb8\x42\xdb\x71\xa2\x45\xed\x1e\x81\xc8\x97\x48\x85\x7c\x75\xe8\xc1\x71\x64\x8c\x65\xf3\x79\xb6\x71\x68\x47\x94\x88\xf3\x5f\x0b\x81\xec\x68\x1b\xe1\xae\xc4\x64\xb0\xc4\x6c\xcf\x28\xf3\x24\x5f\xc8\x9c\x46\x69\xd3\x44\x39\x9e\x81\x7e\x7b\x3e\xf1\x96\xe2\x7b\x84\xa4\xa6\x00\xf0\x61\xdd\xf1\x0a\x31\x65\x7e\xef\x68\x95\x21\x9a\x27\x6a\xa6\x7a\xb4\x8c\xf0\xb5\xc3\x2e\x19\xbb\x58\xa8\xad\xbb\x6c\x89\x29\xf4\xd8\xb7\xd5\x42\x36\x35\x6c\xde\x38\x70\x01\xbc\x05\xe1\x07\x28\x25\xe2\x28\x86\xbb\x2f\x71\x30\x16\x33",
    },
    { RSA3072, 0x10001,
        "\xb6\x59\x34\x31\x9c\x20\x60\x1d\x5f\xec\xf0\x3b\xd2\xe4\xc0\xa3\x1d\xfa\xe9\xae\x73\x1a\x7c\x41\x5b\xab\xa1\xe8\x22\x8f\x16\xff\x11\xcf\x8e\xeb\x59\x4c\xe1\x13\x81\x36\x54\xb0\xef\xd9\xd2\x82\xde\x4a\x52\xb2\xec\xbc\x20\x70\xb9\x96\x80\x94\xeb\x99\xc6\xcc\x2a\x4d\x40\xcc\x47\x7b\xa2\xd1\xc3\x24\x9c\xb6\x1d\x2e\xd1\xa9\xbd\xf2\xaa\xf0\x13\x60\x3c\xda\x49\xeb\xe8\x0c\x0a\x35\x83\x33\xf0\xda\x6d\xab\xff\xb1\x3b\x74\x39\x20\x76\x56\xf8\x89\x4a\xad\x7c\xc6\xb6\xb4\xc1\x22\xf9\x35\x5a\x62\x99\x62\x50\x4e\xea\xe3\x17\xb2\xbb\xa8\xa1\x10\x58\x2f\x95\x5a\xa6\xf4\xc4\x1c\x0b\x31\x1e\x88\x0a\xc8\x2a\xd0\x48\xb0\x85\xf1\x99\x7d\x34\x3a\x99\x54\xc6\x0d\xb6\xf0\x6a\xa0\x58\x69\x79\xad\x9c\x42\xcc\x86\x00\x3a\x40\x4a\x38\x6c\xff\x8c\x1f\x8a\x64\x4a\x8a\x4d\x36\x9a\xbc\x8d\xf4\x67\x0b\x7d\x20\xdc\x88\xd9\x85\x6a\x02\xa1\x88\x21\x68\xe1\xbc\x41\xb2\xc0\xaf\x09\xdc\x90\x6c\xfa\xc6\x2b\xf6\xca\x04\x35\x32\xc8\x38\x57\xaf\x26\xd5\xbe\x46\x84\xa2\xe7\x02\x5f\x47\xfe\x52\x46\x97\x4d\x28\xb5\xed\x7c\xd1\xab\xa8\x01\xc2\x7f\x8a\x34\x48\x91\x56\xe4\x0d\x81\xe3\xed\xeb\x52\x8a\xe4\x3e\x1d\x44\x6c\xae\xec\x20\xa5\xd1\x84\x1c\xc9\x9c\x85\x41\xd1\x4d\x28\x2b\x56\xd4\xa4\x3b\xcf\xfa\xf7\x42\x8e\x8c\x7d\xf4\x38\xc4\x8f\x70\x38\x43\xfd\x47\xaf\x29\x6d\xec\x9f\xed\xdc\x1a\xb2\xa5\xbd\xd5\x47\x83\x46\x73\xef\xe7\x5a\x07\xf0\x4b\xcd\xdf\x2b\x30\x9a\x88\x45\xbc\xbb\xde\x15\x22\xac\x27\xe0\x7a\x47\x0b\xb3\xaf\x2e\xaa\x08\xe5\x6e\x91\xbe\xbb\x7a\x9e\x78\xca\x7f\xf3\x07\xb6\xfb\xad\x11\x77\x04\x1c\xd5\x2d\xb1\x36\x3a\xa9\xf9\x54\xa0\xe2\x95\x15\x53",
        "\x15\x59\x62\x54\x00\x9c\x85\xc4\x4a\xab\xda\x00\x97\x13\x73\x3e\x65\xcf\x2f\xb6\xde\x01\x16\xd5\x2c\x1f\x6f\x28\x57\x8b\x7b\x3c\xc7\xe0\x0e\x32\x9d\xd4\xf3\x71\x2e\x2a\xa7\x45\xc3\xff\x33\xb7\x60\xc1\x40\xe7\x73\xf2\x1e\xb6\x33\xf4\x5b\xff\x93\x8a\x00\x8d\x7c\xd2\x68\xa8\xc2\x21\xc6\x91\x5a\x90\x99\xcc\x74\xa4\x3b\xa5\xec\xf8\x51\x6d\x24\x47\x9b\x38\x4f\x79\x50\x44\xc0\x99\x3d\x50\x42\x7d\xc0\x63\x67\xdf\x5f\x3f\x9f\x44\x9e\xb6\x56\x08\xf4\xf6\x54\xea\x8b\x0f\xa4\xa1\x2c\x9e\x43\x83\xd1\xc3\x81\xf5\x8b\x68\xa5\x28\xa6\xf1\xfa\x51\x88\x91\xa1\xa1\xe8\x74\x35\xd5\xb6\xb5\xbc\x86\x5f\x04\xca\x86\x72\x4c\x40\x92\x65\xcf\x13\xe3\x5c\x7a\x61\x69\xcf\xa6\x5c\x45\x83\xb4\x6d\xab\x96\xe4\xf7\x3f\x25\x1d\xac\xd3\x43\xc1\xf7\x35\x77\xa7\xe3\x50\x1a\xdb\x29\x6e\x7a\x6e\xcd\xb1\xb3\xb0\xb7\x8a\x3e\x27\x47\xa5\x61\x33\x85\xb3\xb2\x7d\xd7\x85\x7b\x41\xca\xfd\xdc\xfb\x0b\xe4\x25\xfe\xb3\x0b\x00\xba\xc0\x6b\x6a\x22\x4f\x09\x89\x86\xc6\x09\x38\xf7\x6f\x75\xef\x98\x2e\x4f\x0f\x78\x18\x0a\x5a\x6b\xa6\xdf\x0c\x14\xcc\x7e\x97\x27\x05\x97\x53\x77\x3a\x62\xe1\xc1\xca\xc3\xc4\x22\xa8\xcb\x8f\xe9\x56\x13\x5c\x17\x7f\xfc\x28\xc2\x6c\xdd\x9e\xd6\x48\xeb\xf5\xd2\x1b\x23\x82\x96\x18\x87\x9d\xc3\x78\xf3\x6a\xbe\xa7\x0a\x68\x8d\x0c\xb7\x0d\x47\x00\x6e\x97\x2d\x72\x70\x53\xa0\x5f\x35\xd7\x72\xc3\xcb\xda\x19\x40\x16\x68\x0f\x9e\x62\xf8\x4a\x61\x31\x59\x92\xe9\xbb\x6c\x79\x4d\xc5\x64\x1e\xc8\xa8\xd9\x45\xf0\x78\xab\xa2\x27\xa6\x2f\x6a\x8c\xbf\x28\x49\x2c\x4c\x75\xb9\x7a\x2d\x60\xf6\x74\x85\xbb\xc6\xb7\x01\xd9\x54\x16\xbf\x42\x66\x2d\xca\x8b\x89",
        "\x4a\x9d\x78\x75\xe0\x64\xa4\x61\xa4\x31\x34\x80\x17\x29\x04\xe7\x62\x3f\x2d\xf2\xb7\x5e\xc0\x85\x9f\xef\xe6\x2c\x66\xd3\x5b\x43\x56\x13\xd3\x2f\x9d\x91\x25\x57\xc5\x7a\x98\xf5\x34\x1e\x16\xc7\x22\x8e\x96\xf7\x31\x00\x64\xb4\xfd\xda\xc4\xd9\x2f\xde\x0b\x10\x6e\x91\x85\x10\x8b\xbf\xe7\x16\x07\x68\xe0\xfa\x61\x73\x15\xee\x02\x36\xef\x34\x57\xa4\x81\x1e\x8e\x30\x2c\x50\x4e\x79\xc7\x78\x35\x1e\xb1\xf0\x43\xf5\x7f\xb8\x7d\x64\xba\x9b\x3c\xcd\x8e\xf1\xc1\x0a\xfa\xf9\x05\x67\x3d\x79\x9e\xa6\xdd\xa6\x94\x93\x2f\x27\x5b\xf6\xff\xec\xe5\x54\x9c\x73\xd9\x9e\xeb\x39\x08\x60\x4f\x75\x62\xcc\x4f\x0c\x6f\x14\x8c\xf4\xca\x35\xdd\xc1\x78\x7e\xdd\x99\x0a\x51\xfb\x34\xae\xe4\x9c\xad\xbd\xf1\xe0\x87\x10\xca\x44\x7e\x84\x8e\x7c\xb1\x43\xd0\x63\xce\xa8\x8e\xce\x91\x7a\xdf\x00\xd2\x38\xab\x4f\xc1\x65\x20\xcd\x1d\xc9\xae\x46\xe5\xcc\x65\xad\x26\x00\x85\xf7\x04\xf3\x4e\x20\xd4\xb1\x3f\x0a\x70\x3b\x0e\x48\x79\x77\x0c\x7c\x9b\xf3\x6b\x1a\x02\x8a\xc8\xe7\x2b\x46\xa3\x8c\x42\x96\x8a\xdb\x91\x6c\xfa\x31\xc1\x15\xef\xec\x46\x06\xc3\xce\x78\x8c\xd5\x9b\x28\x51\xc6\x28\x32\x2f\x96\xcf\x28\x82\x61\x88\xb0\xf3\x30\x64\xea\x15\xc8\x61\x0d\xe0\xc9\x86\x15\x91\x6c\x6f\x9b\x18\xe8\x80\x14\x3f\x3b\x86\xd2\xd0\xc2\x38\x7d\x08\xd3\xb4\x7c\x88\x41\x8b\xf3\x6d\xb2\x30\xe4\x32\x20\x5e\xf6\xea\x03\x31\x3c\x47\xb2\x5d\x6b\x13\x92\x80\x88\xeb\x89\x15\xa6\x99\x35\xfb\x16\x95\xc0\x18\x28\x81\x15\xfc\x0a\x4c\x90\x7e\xe5\x5a\x19\x01\x11\x5b\xd1\xac\xfc\xb8\x49\x52\xdd\x20\xbe\x9d\x03\xf8\xf0\x20\xfb\xaf\x40\x39\xb2\x5f\x32\xa1\x42\xc7\x42\x5c\x24\x24\x80\xdf\x87",
        "\x28\x30\x21\x1a\xff\x31\x07\x8e\x92\x0b\x3a\x9d\x6a\x30\xe1\x51\x96\xab\x39\xc1\xdc\xe0\xb6\xc1\x76\xd8\x82\x1a\x13\xc7\x7d\xaa\x13\xd3\x60\x9e\xf7\xac\x5d\x47\x21\x33\xfc\xc3\x65\xac\xb5\x26\x72\xc0\x0f\xe8\x82\xdd\x81\x3a\xc9\xd3\xd6\x67\xbb\x0e\x7e\xc9\x42\xc6\x1e\xcc\xb3\xd9\xae\x91\xf0\x26\x18\xe1\xdb\x6f\xd0\x98\x3c\xa7\xbe\xf9\x90\x84\x3f\x5f\x3a\x99\x50\xab\xc1\x6d\xe9\xa8\x42\xd3\x7f\x8d\xe7\x8c\x68\x8c\x7d\x58\x2a\xfc\x4e\xb1\xac\xd8\xff\x3d\x65\xe3\xde\x71\x44\x90\x98\x03\x41\xf4\x36\x45\x6c\xaa\x71\x93\xed\xad\x80\xe1\x94\x1c\x48\xf7\x8a\x47\xed\x51\xd0\x93\xec\x96\x1a\xca\xa0\x3d\xab\xc2\x29\x6a\x8d\x7b\x5f\x1b\x09\x78\x93\xb6\x98\x96\x6f\x55\xc1\x97\x24\xba\x7f\xb9\x92\x23\x3e\x08\xaa\xa1\x71\x83\xb0\xdb\x51\x9f\xbc\xe2\xe2\xaf\xdb\x8d\xe8\x85\xa1\x04\x18\x6e\xee\x75\x4c\xf9\x1b\xed\x44\x68\xb6\x56\x24\x44\x3d\xfb\xaa\x33\x1d\xe5\x1e\x22\x35\xd2\xd6\x5c\x2f\x3b\x51\x0b\xfd\xa8\x0c\xd1\x4d\xa2\x5a\xeb\x8e\x60\x9a\x64\xe3\x52\x02\x63\x3e\x59\xdc\x95\x92\xeb\x29\x0f\xe1\x33\x89\xaa\x62\x24\x05\x08\xff\x84\xe4\x8a\xdc\x03\x4f\xcd\x15\x9d\x68\x2a\x1a\x05\x55\x56\xaf\xf6\x7a\xbf\x0a\x2d\x2c\x6f\xae\x3e\xb4\x3e\x38\x91\xfd\x25\xa4\xc5\x5a\x1d\x3c\x4a\x61\x7b\x7d\xf8\x94\x4e\x31\xc0\xa7\x2d\xe7\xf8\x9c\xa1\x78\x34\x64\xa1\x86\x54\xbc\xe8\x43\x85\x68\x89\x8e\x38\xce\x58\x52\xbd\x8f\xcc\xce\x5a\x92\xd2\x51\x94\xa3\x4f\xab\x12\xd5\x5f\x39\x7e\x2c\x11\x6c\x43\x94\x48\xc5\xe6\x51\x4f\x36\xa4\x2e\xe2\x77\xba\x1d\x61\x0f\x87\x5d\x2e\xa4\x1c\x8b\xa0\x8d\xd8\xd6\x84\x9c\x9d\x9f\x04\x08\x41\x72\x49\xaf\x7c\x85\xea",
    },
    { RSA4096, 0x10001,
        "\xc4\x20\xda\x40\xf5\x43\xcb\x14\xa9\x56\x8d\x32\x26\x2a\xf8\x93\xd7\x72\xa1\x60\xa4\x2c\xa6\x9a\x67\xec\xf0\x94\x46\xe2\xdb\x98\x49\x11\xd9\x35\x2f\x43\x5b\xa9\x49\x7a\x15\x7e\x83\xe7\xe3\xd5\xea\xb8\xf1\xb0\x12\x8d\x6e\x5e\x77\x19\x7b\xd8\x05\x05\xf3\x47\x3b\xed\x49\x03\xa7\xd4\x9e\x6b\xe3\x00\x7f\x72\x05\xf6\x38\xd2\x8f\x96\xb5\x1f\x98\x86\x3e\x59\xdd\x09\x96\x2d\x57\xee\xd1\xc4\x41\x55\x8e\x7b\x2f\x1c\x12\x2f\x8d\x08\xbc\xc1\x27\x90\xfa\xcf\x8f\x22\x43\x2b\x31\xd4\xbc\xb4\x99\x9d\xc1\x0d\xc6\xdd\x4e\x2f\x3a\xdb\x63\xd9\x2f\xc0\xef\x28\xbc\x2c\x4e\x21\x12\xd8\x23\x5a\x79\xda\xa0\xf0\x4f\xb4\x05\x0d\xe4\xe7\xf4\x22\x0d\x85\x3e\x83\x72\x56\x1c\x0c\x0f\x6d\xd4\x4c\xce\xd1\xc3\xb6\x79\xce\xbc\x16\x07\x1d\xc6\x27\x77\xc5\x20\xf7\x63\xdc\x3c\xf4\x78\x91\x4d\x2a\x45\x3d\xc7\x35\x06\x38\x7d\xf2\x36\x98\x63\x2c\x15\x6a\x45\x35\x5a\x06\xdd\xac\xc1\x49\x16\xf4\x58\x3b\xed\xdd\x32\x0e\x64\x78\x49\x56\xab\xbd\xea\xf8\xa7\x93\x53\x24\x9a\x9b\x62\xbf\xdc\x3f\x75\x35\xc6\x0e\xb6\x1c\xcb\x24\xd3\xa2\xad\x14\xb5\xd6\x45\x50\x55\x97\x1b\x08\xce\x48\x02\x3f\xbe\x53\x31\xfb\xbf\x18\x32\xf0\x18\xc7\xef\x82\xbb\x3b\x4b\x22\x94\x3a\x6e\xbe\x4c\x91\xce\x8c\x38\x24\x09\xb5\xe4\x8c\x5f\xc0\x9d\x17\x9a\x3b\x61\x6b\xb3\x75\x19\x6a\x25\x02\x81\x9a\x16\xf4\x0a\x19\xa4\x7f\xfa\x8b\xb7\x1d\x3c\xab\xe8\xd3\xec\xe3\x18\xd7\xbc\xce\x85\xf8\xc3\xf8\x62\x2b\x1c\xc4\x4c\x01\xda\xc8\xa2\xad\x0a\xb1\x89\x59\x44\x8e\x1a\x4a\xb8\x2a\x30\x48\x86\x65\x55\xba\xdb\x9d\x80\xc7\x97\x7e\x9f\xbb\x83\x96\xcd\xc1\x42\xca\xe0\x79\xf1\x50\x8e\x81\x0b\xd6\xe8\x4e\x39\xba\x4c\x82\xbb\xfd\xa2\x40\xeb\xa6\x53\x5f\xb0\xb2\x3b\xfb\x5f\x84\x78\x04\x43\x6f\xc9\xbb\x04\x6f\x27\x39\x01\xdd\x02\x76\x9a\x21\x2b\xe8\x01\xaf\x9c\x2e\x32\xf6\x6a\xfd\x79\x90\xde\xc3\xb5\xb8\x29\x64\x88\x6d\x48\x00\xec\x68\x17\xae\xef\x2d\x52\x5f\x8f\x3b\x88\xf5\x42\x8f\x92\x29\x8e\xcf\x22\xb8\xd9\xf7\x4c\x04\x34\xaf\xca\x05\xe2\x30\x9c\x1b\xda\xdd\x79\x36\x45\x0b\x0a\x83\xbe\x46\x74\xae\xc6\xd0\x9d\xbe\xf4\x8c\xa9\xef\x58\x6b\x78\x88\x0c\x89\xc2\x5c\x9a\x3b\x1b\x9f\x8a\x5f\x7e\xea\x85\x97\x3b\xd9",
        "\x49\xa1\x7b\xce\xbf\x45\x80\x4c\x75\x76\x84\xf3\xba\xd8\x8f\x12\x11\xe4\x7b\x29\x68\xf9\x4a\x62\xd5\x79\x62\xa8\x88\x24\x4b\x04\xd5\x09\xda\x5d\xd9\x2c\x94\x90\xed\x80\xe3\xe8\xe7\x64\x7b\x68\xa8\x02\x5e\xda\x17\x5c\xf9\x7e\x85\x80\x0f\xba\x7d\xc8\x4a\x19\x08\x2a\x81\x2a\xda\x2b\x3c\x7e\x8c\x6e\x77\x6a\x3b\x4a\xc0\xf2\x6b\xed\xcc\x79\xdc\x2d\x29\xe3\x5a\xd4\x6a\x89\x03\x66\x29\x62\x60\x94\xda\x34\xec\xee\xc0\xf5\x11\x21\xa2\x9b\x71\x5b\x40\x8e\x03\xd2\x7d\x1d\x0e\x4c\x2b\xbc\x31\x9f\xc4\x06\x84\x0e\x39\x78\x09\xc4\xab\xab\xb1\xfd\xe0\xcb\x8e\x39\xa3\xeb\x4e\xc3\xce\x21\xfd\x75\x52\xce\x65\x5d\xd4\x37\xef\x24\x15\xc7\x63\x04\x0f\x00\x12\x40\xb9\xae\xdd\x6c\x02\x34\x03\xc1\x44\x94\x91\x0e\x48\x16\x8c\xfd\x64\x93\x14\xa7\xf1\x44\x6f\x3d\x13\xb5\x44\x3e\x68\x95\xe2\x00\xdb\x74\xd0\xad\x0c\xbb\x8e\x3b\x8f\x9f\xd1\x3a\x60\x59\x33\x3f\x38\xa1\xce\xbe\xbd\xdb\x65\xf4\xb9\xcc\x3d\x2a\xa2\x15\x76\x93\x0f\x4e\xf1\x94\x00\x75\x92\xd5\x3f\x25\xee\xe0\xd0\xb3\x12\x31\xe9\xf5\x43\xf1\x73\x62\x94\x01\x92\xb1\x1f\xc3\x1d\xa9\xee\x88\x35\xf4\x8f\x92\xf5\xc9\x6a\x0f\xc6\x79\x55\x35\xbb\x35\xfe\xd4\xec\xed\x7b\xf9\x11\x85\x04\x64\xa9\x3f\xb6\x83\xa5\x3a\xf3\x9b\x18\xe8\x84\x90\xc1\xdc\x75\x36\xc3\xc9\xb1\x34\xe3\xd3\x07\xd8\x2d\x93\xd4\x9c\x97\xbb\x8a\x1d\xe6\x77\xbb\xfc\xd2\xd9\xa9\x14\x31\x32\xbb\x74\xad\x4b\xc0\x7b\xf2\xb0\x23\x83\x1c\x38\xd7\xcc\x90\x85\xd2\x27\x20\x3a\x7b\xb6\x8a\x05\x8c\x40\xcd\xf3\x50\xaf\x6e\x33\x87\xd4\x65\x41\xa5\xc0\x26\x1e\xae\x54\xdd\x2e\x71\x5a\xee\xdb\xde\x56\x24\x31\x12\x9f\xc0\xdd\x28\xa5\x96\x5e\x10\x82\xa4\x78\x0c\x85\xd2\x1e\x40\x98\x3d\x31\x04\x13\x5b\x99\x9b\x04\x4d\x50\x97\xb9\xdd\x4e\xbe\x34\x7c\x21\x89\xb7\x88\x9c\x94\x83\xff\x66\x25\x18\xfe\xc0\xe1\x31\x19\xd4\x2c\xac\x49\xf9\xd5\xfc\xde\xe7\x11\x4c\xf4\x21\x30\x0e\x3d\xed\x96\x19\x23\x9c\x6b\x92\xf5\x63\x6e\xbb\x15\x50\x76\x29\xcb\x32\x4f\xa6\xf4\x8f\x5f\xbc\x5d\xd6\xb9\xbf\x20\xc7\x76\xd2\xa6\x05\x53\x7a\xc5\xc6\xf5\x6e\x68\x2c\x0a\x14\x2e\x9d\xd8\xfe\xae\x72\x3b\x0b\x21\x06\xce\x12\xe3\x40\xe9\x13\xaa\x06\xf7\xea\x58\x19\x34\xdc\xaf\xb1",
        "\x6b\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xbb\xba\xac\x2d\xa8\xbe\x04\xcf\x41\xe6\x9c\x57\x66\x13\x3c\x80\x32\x94\x0c\xce\x98\xe9\xfc\xe2\xc9\x2a\x83\x8f\xa2\xec\x3a\xd1\x36\xc2\x9d\x04\x40\x54\xc4\x66\x32\x99\xf3\x09\x5e\xaa\xfd\x75\x1e\xc4\x16\x34\x52\x83\x75\x33\x70\xa4\xec\xe0\x11\x22\x6c\x9b\x8c\xf7\x35\xcc",
        "\x15\xda\x45\x2a\x02\x5d\x7c\xcf\x78\xfe\xad\x7f\xf8\xf3\x99\xb0\x14\xd4\xbd\x0c\x51\xdd\xe7\xe2\xba\x72\xef\x35\x2c\x3d\x80\xd7\xc6\x75\x2b\xd7\x50\x92\xd0\x8d\x4b\x02\xee\x48\x0e\x5c\xed\x7f\xc4\x49\x55\x6e\x20\x63\x5d\x05\xc8\xae\x3b\x67\xbe\x03\xa6\x00\x74\x6e\x82\x6f\x91\x6a\xf2\x46\x1b\xa8\x76\x63\x4d\x37\xba\x12\xf8\x83\x2d\x01\xfc\x8a\x4b\x37\xf1\xc5\x36\x06\x86\x12\xee\x5b\x11\x29\x3b\xf9\x11\xfc\x7c\xc7\x56\x5e\xa1\x7e\x68\xdd\x01\xb6\x9d\x80\x80\x1f\x3a\xb1\x32\xb6\x21\x9e\xdd\x4f\xed\xbb\x62\xa4\x6c\x8c\x2d\x11\xb7\x61\x94\x30\x2a\xc4\xee\x3b\xb5\x83\xc8\xcc\xe8\x2b\x5c\xcb\x34\x0f\xb7\xa5\x28\xdf\x3d\x34\x32\x79\x1c\x66\x58\x59\x2f\x29\x75\xdf\xe9\xec\x17\xe4\x78\xcc\x8b\x40\xc8\x9e\x99\x84\x24\x9e\x7c\x82\x2e\xe1\xbd\xd3\xdc\x7c\xa2\x1b\x2c\x98\xf5\xbf\x68\x9b\x22\x2c\x9c\x97\x02\xcf\x1d\x7f\x48\x19\x66\x07\x5e\x3f\x65\x9e\xe8\xf8\xb4\xe9\x37\x9c\x11\x06\x4b\xad\xd6\xfb\x49\x5b\x87\x13\x61\x7f\xef\xfc\xe5\x29\xd8\x32\xc8\x81\x49\x0e\x46\xa5\x46\xf0\xe5\x11\xf6\x06\xb9\xc1\xee\x9f\x04\x8c\xcb\xe9\x0a\xdf\x68\x5d\x24\x4b\xe1\x16\xc3\xaa\xe5\x2b\xfc\xb6\x81\xe7\xe6\xbe\xa1\xb2\x1b\x16\xbf\x74\x9c\xc9\xd6\x81\x6c\x10\xc8\x52\x85\xfe\x9f\x13\x50\x5d\xaf\x9e\x86\x0e\x97\x0d\x15\x71\x98\x3a\x2c\x02\xc4\x57\x75\x35\x4b\x86\x8c\xcc\xed\x88\xc4\x68\x73\x0f\x16\x5b\xb1\xaa\xa6\x1d\x8b\x77\xa1\xed\xec\x1b\x7a\x69\x28\xc9\x30\xd1\x44\x96\x76\xb3\xe7\x18\x5d\x8b\xa4\x13\x85\x8c\x0a\x2e\x38\x99\x41\xd3\xb4\xad\xa5\x2f\xd5\x1a\xc4\x2b\x69\x26\xd7\x6b\xcb\xe9\x80\x51\x31\xa1\x6e\xe2\xd3\x80\x27\x3c\x00\x49\x5a\x79\x81\x42\xe9\x41\x4e\xbc\x0a\x33\x75\xb4\x72\x87\x30\x49\x20\xb7\x35\x8e\xce\x1e\xf0\x47\x88\x93\xb8\xf5\x3f\x3c\x37\xbb\x59\x65\x73\xf4\x3a\x18\x95\x04\x5f\x7d\x5f\xba\x27\x84\x1e\x9d\xbd\xbc\x4d\x20\xc3\x51\xee\x1c\x15\xb5\x7b\x6a\xda\xff\x59\x1e\x95\x05\x0b\x54\x1c\x9e\xc3\xc7\xd8\x85\x1b\x9d\x8d\x8c\xdf\xe8\x1a\x6a\x07\x8f\xab\xfa\x25\xfc\x0a\xe2\x84\x90\x79\x92\x64\xc4\xfd\xc2\x68\x6e\xa3\xed\x18\x48\x8a\x2c\xff\xec\x35\x8b\x46\x51\xe8\x7c\x94\xcc\xb5\x9c\x02\xd7\xf5\xf7\x49\x0b\x5b\x52\x62\x4c\x26\xdb",
    },
};

static const struct hash_test_pattern
{
    uint32_t msglen;
    const void *msg;
    const void *md;
} hash_tp[] =
{
    {
        0,
        NULL,
        "\xe3\xb0\xc4\x42\x98\xfc\x1c\x14\x9a\xfb\xf4\xc8\x99\x6f\xb9\x24\x27\xae\x41\xe4\x64\x9b\x93\x4c\xa4\x95\x99\x1b\x78\x52\xb8\x55",
    },
    {
        163,
        "\x45\x11\x01\x25\x0e\xc6\xf2\x66\x52\x24\x9d\x59\xdc\x97\x4b\x73\x61\xd5\x71\xa8\x10\x1c\xdf\xd3\x6a\xba\x3b\x58\x54\xd3\xae\x08\x6b\x5f\xdd\x45\x97\x72\x1b\x66\xe3\xc0\xdc\x5d\x8c\x60\x6d\x96\x57\xd0\xe3\x23\x28\x3a\x52\x17\xd1\xf5\x3f\x2f\x28\x4f\x57\xb8\x5c\x8a\x61\xac\x89\x24\x71\x1f\x89\x5c\x5e\xd9\x0e\xf1\x77\x45\xed\x2d\x72\x8a\xbd\x22\xa5\xf7\xa1\x34\x79\xa4\x62\xd7\x1b\x56\xc1\x9a\x74\xa4\x0b\x65\x5c\x58\xed\xfe\x0a\x18\x8a\xd2\xcf\x46\xcb\xf3\x05\x24\xf6\x5d\x42\x3c\x83\x7d\xd1\xff\x2b\xf4\x62\xac\x41\x98\x00\x73\x45\xbb\x44\xdb\xb7\xb1\xc8\x61\x29\x8c\xdf\x61\x98\x2a\x83\x3a\xfc\x72\x8f\xae\x1e\xda\x2f\x87\xaa\x2c\x94\x80\x85\x8b\xec",
        "\x3c\x59\x3a\xa5\x39\xfd\xcd\xae\x51\x6c\xdf\x2f\x15\x00\x0f\x66\x34\x18\x5c\x88\xf5\x05\xb3\x97\x75\xfb\x9a\xb1\x37\xa1\x0a\xa2",
    },
    {
        64,
        "\x45\x11\x01\x25\x0e\xc6\xf2\x66\x52\x24\x9d\x59\xdc\x97\x4b\x73\x61\xd5\x71\xa8\x10\x1c\xdf\xd3\x6a\xba\x3b\x58\x54\xd3\xae\x08\x6b\x5f\xdd\x45\x97\x72\x1b\x66\xe3\xc0\xdc\x5d\x8c\x60\x6d\x96\x57\xd0\xe3\x23\x28\x3a\x52\x17\xd1\xf5\x3f\x2f\x28\x4f\x57\xb8",
        "\x1a\xaa\xf9\x28\x5a\xf9\x45\xb8\xa9\x7c\xf1\x4f\x86\x9b\x18\x90\x14\xc3\x84\xf3\xc7\xc2\xb7\xd2\xdf\x8a\x97\x13\xbf\xfe\x0b\xf1",
    },
    {
        32,
        "\x45\x11\x01\x25\x0e\xc6\xf2\x66\x52\x24\x9d\x59\xdc\x97\x4b\x73\x61\xd5\x71\xa8\x10\x1c\xdf\xd3\x6a\xba\x3b\x58\x54\xd3\xae\x08",
        "\xb3\xad\xf1\x28\xb3\xb8\x83\x99\x92\x4a\x6b\x38\x88\x6a\x5b\xf1\x22\x65\xaa\xa8\x14\xce\xa9\xc1\x9b\x7f\x55\x8e\x4a\x74\xc8\x14",
    },
    {
        128,
        "\x45\x11\x01\x25\x0e\xc6\xf2\x66\x52\x24\x9d\x59\xdc\x97\x4b\x73\x61\xd5\x71\xa8\x10\x1c\xdf\xd3\x6a\xba\x3b\x58\x54\xd3\xae\x08\x6b\x5f\xdd\x45\x97\x72\x1b\x66\xe3\xc0\xdc\x5d\x8c\x60\x6d\x96\x57\xd0\xe3\x23\x28\x3a\x52\x17\xd1\xf5\x3f\x2f\x28\x4f\x57\xb8\x45\x11\x01\x25\x0e\xc6\xf2\x66\x52\x24\x9d\x59\xdc\x97\x4b\x73\x61\xd5\x71\xa8\x10\x1c\xdf\xd3\x6a\xba\x3b\x58\x54\xd3\xae\x08\x6b\x5f\xdd\x45\x97\x72\x1b\x66\xe3\xc0\xdc\x5d\x8c\x60\x6d\x96\x57\xd0\xe3\x23\x28\x3a\x52\x17\xd1\xf5\x3f\x2f\x28\x4f\x57\xb8",
        "\xa9\x9d\xb8\xc7\x02\x2f\xa9\x9e\x97\x62\x19\xae\x69\x96\x7a\x61\x6d\x23\xa5\x15\x4c\x1c\xa4\xca\xcd\x59\x85\xd9\x6b\x77\xe8\x82",
    },
};

static const struct gcm_test_pattern
{
	uint32_t keybits;
	const void *key;
	uint32_t ptlen;
	const void *pt;
	uint32_t ivlen;
	const void *iv;
	uint32_t aadlen;
	const void *aad;
	uint32_t ctlen;
	const void *ct;
	uint32_t taglen;
	const void *tag;
} aes_gcm_tp[] = 
{
	// encrypt, ptlen = 0
	{ 256, "\xb5\x2c\x50\x5a\x37\xd7\x8e\xda\x5d\xd3\x4f\x20\xc2\x25\x40\xea\x1b\x58\x96\x3c\xf8\xe5\xbf\x8f\xfa\x85\xf9\xf2\x49\x25\x05\xb4",
      0, "",
      12, "\x51\x6c\x33\x92\x9d\xf5\xa3\x28\x4f\xf4\x63\xd7",
      0, "",
      0, "",
      16, "\xbd\xc1\xac\x88\x4d\x33\x24\x57\xa1\xd2\x66\x4f\x16\x8c\x76\xf0",
    },
	// encrypt, ptlen = 51
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      51, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      51, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8",
      16, "\xbc\x95\xc5\x32\xfe\xcc\x59\x4c\x36\xd1\x55\x02\x86\xa7\xa3\xf0",
    },
	// encrypt, ptlen > 104
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      156, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47",
      16, "\xdb\x69\x62\x47\x08\xd3\x3b\x12\xe0\x3b\x31\xdd\x59\x4a\x08\x6b",
    },
	// encrypt, aadlen > 32
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      40, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      156, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47",
      16, "\xfa\x1c\x43\xfb\xaf\x01\x63\x51\xb5\x6f\x1d\xab\x7a\x40\xc4\x0d",
    },
	// encrypt, aadlen = 0
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      0, "",
      156, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47",
      16, "\x8a\xce\xeb\x25\x53\x16\x0f\xd1\xc9\xf5\xe8\x19\x85\xa2\xd9\xbb",
    },
	


	// decrypt, ptlen = 0
	{ 256, "\xb5\x2c\x50\x5a\x37\xd7\x8e\xda\x5d\xd3\x4f\x20\xc2\x25\x40\xea\x1b\x58\x96\x3c\xf8\xe5\xbf\x8f\xfa\x85\xf9\xf2\x49\x25\x05\xb4",
      0, "",
      12, "\x51\x6c\x33\x92\x9d\xf5\xa3\x28\x4f\xf4\x63\xd7",
      0, "",
      16, "\xbd\xc1\xac\x88\x4d\x33\x24\x57\xa1\xd2\x66\x4f\x16\x8c\x76\xf0",
      16, "\xbd\xc1\xac\x88\x4d\x33\x24\x57\xa1\xd2\x66\x4f\x16\x8c\x76\xf0",
    },
	// decrypt, ptlen = 1
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      1, "\x27",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      17, "\xeb\x63\x35\xe1\xd4\x9e\x89\x88\xea\xc4\x8e\x42\x19\x4e\x5f\x56\xdb",
      16, "\x63\x35\xe1\xd4\x9e\x89\x88\xea\xc4\x8e\x42\x19\x4e\x5f\x56\xdb",
    },
	// decrypt, ptlen = 16
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      16, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      32, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xd3\xaa\x97\x58\x15\xa0\x51\xd2\x5b\x7f\x29\xf1\x69\x6f\x6f\x21",
      16, "\xd3\xaa\x97\x58\x15\xa0\x51\xd2\x5b\x7f\x29\xf1\x69\x6f\x6f\x21",
    },
	// decrypt, ptlen = 17
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      17, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      33, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x9a\x5d\x58\xd0\xc9\xf8\x48\x96\xb3\xe4\x67\x4a\xa9\x04\xad\x97",
      16, "\x9a\x5d\x58\xd0\xc9\xf8\x48\x96\xb3\xe4\x67\x4a\xa9\x04\xad\x97",
    },
	// decrypt, ptlen = 52
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      52, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      68, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\x54\x5d\xc1\xfa\x62\x39\x58\x88\xc6\xc7\x91\xdd\x94\x15\x93\xda",
      16, "\x54\x5d\xc1\xfa\x62\x39\x58\x88\xc6\xc7\x91\xdd\x94\x15\x93\xda",
    },
	// decrypt, ctlen > 104
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      20, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      172, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47\xdb\x69\x62\x47\x08\xd3\x3b\x12\xe0\x3b\x31\xdd\x59\x4a\x08\x6b",
      16, "\xdb\x69\x62\x47\x08\xd3\x3b\x12\xe0\x3b\x31\xdd\x59\x4a\x08\x6b",
    },
	// decrypt, aadlen > 32
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      40, "\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef\xad\xb5\xec\x72\x0c\xcf\x98\x98\x50\x00\x28\xbf\x34\xaf\xcc\xbc\xac\xa1\x26\xef",
      172, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47\xfa\x1c\x43\xfb\xaf\x01\x63\x51\xb5\x6f\x1d\xab\x7a\x40\xc4\x0d",
      16, "\xfa\x1c\x43\xfb\xaf\x01\x63\x51\xb5\x6f\x1d\xab\x7a\x40\xc4\x0d",
    },
	// decrypt, aadlen = 0
	{ 256, "\x24\x50\x1a\xd3\x84\xe4\x73\x96\x3d\x47\x6e\xdc\xfe\x08\x20\x52\x37\xac\xfd\x49\xb5\xb8\xf3\x38\x57\xf8\x11\x4e\x86\x3f\xec\x7f",
      156, "\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99\x27\xf3\x48\xf9\xcd\xc0\xc5\xbd\x5e\x66\xb1\xcc\xb6\x3a\xd9\x20\xff\x22\x19\xd1\x4e\x8d\x63\x1b\x38\x72\x26\x5c\xf1\x17\xee\x86\x75\x7a\xcc\xb1\x58\xbd\x9a\xbb\x38\x68\xfd\xc0\xd0\xb0\x74\xb5\xf0\x1b\x2c\x99",
      12, "\x9f\xf1\x85\x63\xb9\x78\xec\x28\x1b\x3f\x27\x94",
      0, "",
      172, "\xeb\x7c\xb7\x54\xc8\x24\xe8\xd9\x6f\x7c\x6d\x9b\x76\xc7\xd2\x6f\xb8\x74\xff\xbf\x1d\x65\xc6\xf6\x4a\x69\x8d\x83\x9b\x0b\x06\x14\x5d\xae\x82\x05\x7a\xd5\x59\x94\xcf\x59\xad\x7f\x67\xc0\xfa\x5e\x85\xfa\xb8\x46\xba\x43\x30\xea\x69\xa8\x59\x42\x0b\x15\x98\x7e\x82\x15\xa7\xde\x65\xcd\xf8\x90\x1b\x85\xef\x11\xda\x85\x96\x44\xde\x82\xcd\x86\xe1\x0b\xe1\x01\xfe\xb8\x0b\xa5\xf9\xb8\x15\x5c\x59\xbb\x96\x21\xc3\x2f\x54\xbd\x8d\x10\xe3\x3b\xa9\xca\x47\x93\x87\x3a\xb8\x11\x71\x69\xb3\x03\x40\x5f\xce\x48\xa0\xd0\x3d\x9e\x18\x97\x97\x6a\x62\x90\x19\xcd\xea\x71\x58\x10\x3e\x2a\x74\xf0\xaa\x33\xa7\x43\xfa\xc6\x61\x4d\x71\xf6\xe5\x47\x8a\xce\xeb\x25\x53\x16\x0f\xd1\xc9\xf5\xe8\x19\x85\xa2\xd9\xbb",
      16, "\x8a\xce\xeb\x25\x53\x16\x0f\xd1\xc9\xf5\xe8\x19\x85\xa2\xd9\xbb",
    },
	
};

int socket_rsa(rsa_type_t rsatype,
                unsigned int op,
                const uint8_t *n,
                uint32_t e,
                const uint8_t *d,
                uint8_t *in,
                uint8_t *out,
                uint32_t *outlen)
{
    int len;
    int opfd;
	int tfmfd;
	int cmsg_size;
    uint8_t iv = 1;

    switch(rsatype)
    {
        case RSA1024:
            len = 128;
            break;
        case RSA2048:
            len = 256;
            break;
        case RSA3072:
            len = 384;
            break;
        case RSA4096:
            len = 512;
            break;
        default:
            return -1;
    }

    struct sockaddr_alg sa = {
		.salg_family = AF_ALG,
		.salg_type = "skcipher",
		.salg_name = "k230-rsa",
	};

	uint8_t *key = (uint8_t *)malloc(len*2 + 4);
	memset(key, 0, (len*2+4));
	memcpy(key, n, len);
    memcpy(key+len, d, len);
    memcpy(key+len*2, &e, 4);

	tfmfd = socket(AF_ALG, SOCK_SEQPACKET, 0);
    bind(tfmfd, (struct sockaddr *)&sa, sizeof(sa));
    setsockopt(tfmfd, SOL_ALG, ALG_SET_KEY, key, (len*2 + 4));
    opfd = accept(tfmfd, NULL, 0);

    struct msghdr msg = {};
    struct cmsghdr *cmsg;
    struct iovec iov[2];

	cmsg_size = CMSG_SPACE(4);
	cmsg_size += CMSG_SPACE(sizeof(struct af_alg_iv) + 1);
	char *cbuf = (char *)malloc(cmsg_size);
    memset(cbuf, 0, cmsg_size);
	unsigned char *buf = (unsigned char *)malloc(len);
    struct af_alg_iv *algiv;

    // set header for operation
    msg.msg_control = cbuf;
    msg.msg_controllen = cmsg_size;
	msg.msg_iov = iov;

    cmsg = CMSG_FIRSTHDR(&msg);
    cmsg->cmsg_level = SOL_ALG;
    cmsg->cmsg_type = ALG_SET_OP;
    cmsg->cmsg_len = CMSG_LEN(4);
    *(__u32 *)CMSG_DATA(cmsg) = op;

    // set header for in data
    iov[0].iov_base = (void *)in;
    iov[0].iov_len = len;
    msg.msg_iovlen = 1;

    // set header for iv
    cmsg = CMSG_NXTHDR(&msg, cmsg);
    cmsg->cmsg_level = SOL_ALG;
    cmsg->cmsg_type = ALG_SET_IV;
    cmsg->cmsg_len = CMSG_LEN(sizeof(*algiv) + 1);
    algiv = (void *)CMSG_DATA(cmsg);
    algiv->ivlen = 1;
    memcpy(algiv->iv, &iv, 1);

    sendmsg(opfd, &msg, MSG_DONTWAIT);

	iov[0].iov_base = (void *)buf;
	iov[0].iov_len = len;
	msg.msg_iovlen = 1;
	msg.msg_control = NULL;
	msg.msg_controllen = 0;

	// receive message
	recvmsg(opfd, &msg, MSG_DONTWAIT);

    memcpy(out, buf, (len) * sizeof(unsigned char));
    *outlen = len;

	free(key);
	free(buf);
	free(cbuf);
    close(opfd);
    close(tfmfd);
    return 0;
}

int socket_hash(const void *msg, uint32_t msglen, uint8_t *dgest)
{
	int opfd;
	int tfmfd;

	struct sockaddr_alg sa = {
		.salg_family = AF_ALG,
		.salg_type = "hash",
		.salg_name = "sha256",
	};

	tfmfd = socket(AF_ALG, SOCK_SEQPACKET, 0);

	bind(tfmfd, (struct sockaddr *)&sa, sizeof(sa));

	opfd = accept(tfmfd, NULL, 0);

	write(opfd, msg, msglen);
	read(opfd, dgest, 32);

	close(opfd);
	close(tfmfd);

	return 0;
}

int socket_aes_gcm_cipher(const uint8_t *key,
						uint32_t keybits,
						unsigned int op,
						const uint8_t *in,
						uint32_t inlen,
						const uint8_t *aad,
						uint32_t aadlen,
						const uint8_t *iv,
						uint32_t ivlen,
						const uint8_t *tag,
						uint32_t taglen,
						uint8_t *out)
{
	int tfmfd;
	int opfd;
	int cmsg_size;
	int out_msg_len = (op == ALG_OP_DECRYPT) ? inlen : (inlen + taglen);
	unsigned char *buf = (unsigned char *)malloc(out_msg_len + 256);

	struct sockaddr_alg sa = {
		.salg_family = AF_ALG,
		.salg_type = "aead",
		.salg_name = "gcm(aes)",
	};

	// create and bind socket
	tfmfd = socket(AF_ALG, SOCK_SEQPACKET, 0);
	// printf("open socket\n");
	bind(tfmfd, (struct sockaddr *)&sa, sizeof(sa));

	//set socket options: key, AEAD Authentication size
	setsockopt(tfmfd, SOL_ALG, ALG_SET_KEY, key, (keybits >> 3));
	setsockopt(tfmfd, SOL_ALG, ALG_SET_AEAD_AUTHSIZE, NULL, 16);
	//accept connection
	opfd = accept(tfmfd, NULL, 0);

	//Prepare Message
	struct msghdr msg = {};
	struct cmsghdr *cmsg;
	struct iovec iov[2];

	cmsg_size = CMSG_SPACE(4);
	cmsg_size += aadlen ? CMSG_SPACE(4) : 0;
	cmsg_size += ivlen ? CMSG_SPACE(sizeof(struct af_alg_iv) + ivlen) : 0;
    char *cbuf = (char *)malloc(cmsg_size);
    memset(cbuf, 0, cmsg_size);

	msg.msg_control = cbuf;
	msg.msg_controllen = cmsg_size;
	msg.msg_iov = iov;

	//set the Headervalues for the Operation
	cmsg = CMSG_FIRSTHDR(&msg);
	cmsg->cmsg_level = SOL_ALG;
	cmsg->cmsg_type = ALG_SET_OP;
	cmsg->cmsg_len = CMSG_LEN(4);
	*(__u32 *)CMSG_DATA(cmsg) = op;

	//set headervalues for aad
	if(aadlen)
	{
		cmsg = CMSG_NXTHDR(&msg, cmsg);
        cmsg->cmsg_level = SOL_ALG;
        cmsg->cmsg_type = ALG_SET_AEAD_ASSOCLEN;
        cmsg->cmsg_len = CMSG_LEN(4);
		unsigned int ad_data = (void *)CMSG_DATA(cmsg);
        *(unsigned int *)CMSG_DATA(cmsg) = aadlen;

		iov[0].iov_base = (void *)aad;
        iov[0].iov_len = aadlen;
        iov[1].iov_base = (void *)in;
        iov[1].iov_len = inlen;
        msg.msg_iovlen = 2;
	}
	else
	{
		iov[0].iov_base = (void *)in;
		iov[0].iov_len = inlen;
		msg.msg_iovlen = 1;
	}

	//set headervalues for iv
	if(ivlen)
	{
		struct af_alg_iv *algiv;

		cmsg = CMSG_NXTHDR(&msg, cmsg);
		cmsg->cmsg_level = SOL_ALG;
		cmsg->cmsg_type = ALG_SET_IV;
		cmsg->cmsg_len = CMSG_LEN(sizeof(*algiv) + ivlen);

		algiv = (void *)CMSG_DATA(cmsg);
		algiv->ivlen = ivlen;
		memcpy(algiv->iv, iv, ivlen);
	}

	// send message
	// sendmsg(opfd, &msg, 0);
	sendmsg(opfd, &msg, MSG_DONTWAIT);

	if (aadlen)
	{
		iov[0].iov_base = malloc(aadlen);
		iov[0].iov_len = aadlen;
		iov[1].iov_base = (void *)buf;
		iov[1].iov_len = out_msg_len;
		msg.msg_iovlen = 2;

		msg.msg_control = NULL;
		msg.msg_controllen = 0;

		// receive message
		// recvmsg(opfd, &msg, 0);
		recvmsg(opfd, &msg, MSG_DONTWAIT);

		free(iov[0].iov_base);
	}
	else
	{
		iov[0].iov_base = (void *)buf;
		iov[0].iov_len = out_msg_len;
		msg.msg_iovlen = 1;

		msg.msg_control = NULL;
		msg.msg_controllen = 0;

		// receive message
		recvmsg(opfd, &msg, MSG_DONTWAIT);
    }

	memcpy(out, buf, (out_msg_len) * sizeof(unsigned char));

	free(buf);
    free(cbuf);
	close(opfd);
	close(tfmfd);
	
	return 0;
}

int do_rsa(void)
{
	int i, j;
	int ntests = sizeof(rsa_tp) / sizeof(struct rsa_test_pattern);
    uint8_t out[512];
    uint32_t outlen = 0;

    printf("RSA SIGN......\n");
    for(i=0; i<ntests; i++)
    {
        printf("case %d, rsatype = %d\n", i, rsa_tp[i].rsatype);
        socket_rsa(rsa_tp[i].rsatype, ALG_OP_DECRYPT, rsa_tp[i].n, rsa_tp[i].e, rsa_tp[i].d, rsa_tp[i].m, out, &outlen);

        if(memcmp(out, rsa_tp[i].s, outlen) == 0)
        {
            printf("RSA sign Success!\n");
            for(j=0; j<outlen; j++)
                printf("0x%x\n", out[j]);
			
        }
        else
        {
            printf("RSA calculate Fail!\n");
            printf("golden message signature       computed message signature\n\r");
            for(j=0; j<outlen; j++)
                printf("0x%x 0x%x\n", *(uint8_t *)(rsa_tp[i].s + j), out[j]);
        }
    }

    printf("\nRSA VERIFY......\n");
    for(i=0; i<ntests; i++)
    {
        printf("case %d, rsatype = %d\n", i, rsa_tp[i].rsatype);
        socket_rsa(rsa_tp[i].rsatype, ALG_OP_ENCRYPT, rsa_tp[i].n, rsa_tp[i].e, rsa_tp[i].d, rsa_tp[i].s, out, &outlen);

        if(memcmp(out, rsa_tp[i].m, outlen) == 0)
        {
            printf("RSA verify Success!\n");
			for(j=0; j<outlen; j++)
                printf("0x%x\n", out[j]);
        }
        else
        {
            printf("RSA calculate Fail!\n");
            printf("golden message verify       computed message verify\n\r");
            for(j=0; j<outlen; j++)
                printf("0x%x 0x%x\n", *(uint8_t *)(rsa_tp[i].m + j), out[j]);
        }
    }
	return 0;
}

int do_hash(void)
{
    int i, j;
	int ntests = sizeof(hash_tp) / sizeof(struct hash_test_pattern);
    uint8_t out[32];

    for(i=0; i<ntests; i++)
    {
        printf("case %d, msglen = %d\n", i, hash_tp[i].msglen);
        socket_hash(hash_tp[i].msg, hash_tp[i].msglen, out);

        if(memcmp(out, hash_tp[i].md, 32) == 0)
        {
            printf("sha256 calculate Success!\n");
			for(j=0; j<32; j++)
                printf("0x%x\n", out[j]);
        }
        else
        {
            printf("sha256 calculate Fail!\n");
            printf("golden message digest       computed message digest\n\r");
            for(j=0; j<32; j++)
                printf("0x%x 0x%x\n", *(uint8_t *)(hash_tp[i].md + j), out[j]);
        }
    }

    return 0;
}

int do_aes_gcm(void)
{
    int i, j;

    int ntests = sizeof(aes_gcm_tp) / sizeof(struct gcm_test_pattern);
	uint8_t out[AES_TEST_LEN];

#ifdef _debug
	printf("GCM_ENCRYPT......\n");
	for(i=0; i<1; i++)
	{
		/* aes gcm test */
		socket_aes_gcm_cipher(aes_gcm_tp[i].key, aes_gcm_tp[i].keybits,
							ALG_OP_ENCRYPT,
							aes_gcm_tp[i].pt, aes_gcm_tp[i].ptlen,
							aes_gcm_tp[i].aad, aes_gcm_tp[i].aadlen, 
							aes_gcm_tp[i].iv, aes_gcm_tp[i].ivlen,
							aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen,
							out);

		if((memcmp(out, aes_gcm_tp[i].ct, aes_gcm_tp[i].ctlen) == 0) && (memcmp(out+aes_gcm_tp[i].ctlen, aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen) == 0))
		{
			printf("gcm encrypt ok\n");
		#if 0
			printf("golden ciphertext	computed ciphertext\n\r");
			for(j=0; j<aes_gcm_tp[i].ctlen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].ct + j), out[j]);
			}

			printf("golden tag	computed tag\n\r");
			for(j=0; j<aes_gcm_tp[i].taglen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].tag + j), *(uint8_t *)(out+aes_gcm_tp[i].ctlen + j));
			}
		#endif
		}
		else
		{
			printf("gcm encrypt fail\n");
			printf("golden ciphertext	computed ciphertext:\n\r");
			for(j=0; j<aes_gcm_tp[i].ctlen; j++)
			{
				printf("0x%x 0x%x\n", *(uint8_t *)(aes_gcm_tp[i].ct + j), out[j]);
			}

			printf("golden tag	computed tag\n\r");
			for(j=0; j<aes_gcm_tp[i].taglen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].tag + j), *(uint8_t *)(out+aes_gcm_tp[i].ctlen + j));
			}
		}
	}

	printf("GCM_DECRYPT......\n");
	for(i=2; i<ntests; i++)
	{
		/* aes gcm test */
		socket_aes_gcm_cipher(aes_gcm_tp[i].key, aes_gcm_tp[i].keybits,
							ALG_OP_DECRYPT,
							aes_gcm_tp[i].ct, aes_gcm_tp[i].ctlen,
							aes_gcm_tp[i].aad, aes_gcm_tp[i].aadlen, 
							aes_gcm_tp[i].iv, aes_gcm_tp[i].ivlen,
							aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen,
							out);

		if(memcmp(out, aes_gcm_tp[i].pt, aes_gcm_tp[i].ptlen) == 0)
		{
			printf("gcm decrypt ok\n");
		#if 0
			printf("golden plaintext	computed plaintext\n\r");
			for(j=0; j<aes_gcm_tp[i].ptlen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].pt + j), out[j]);
			}
		#endif
		}
		else
		{
			printf("gcm decrypt fail\n");
			printf("golden plaintext	computed plaintext\n\r");
			for(j=0; j<aes_gcm_tp[i].ptlen; j++)
			{
				printf("0x%x 0x%x\n", *(uint8_t *)(aes_gcm_tp[i].pt + j), out[j]);
			}
		}
	}
#endif

#if 1
	printf("GCM_ENCRYPT......\n");

	for(i=0; i<ntests-8; i++)
	{
		/* aes gcm test */
		socket_aes_gcm_cipher(aes_gcm_tp[i].key, aes_gcm_tp[i].keybits,
							ALG_OP_ENCRYPT,
							aes_gcm_tp[i].pt, aes_gcm_tp[i].ptlen,
							aes_gcm_tp[i].aad, aes_gcm_tp[i].aadlen, 
							aes_gcm_tp[i].iv, aes_gcm_tp[i].ivlen,
							aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen,
							out);

		printf("Case %d: ptlen %d, aadlen %d, ivlen %d\n\r", i+1, aes_gcm_tp[i].ptlen, aes_gcm_tp[i].aadlen, aes_gcm_tp[i].ivlen);

		if((memcmp(out, aes_gcm_tp[i].ct, aes_gcm_tp[i].ctlen) == 0) && (memcmp(out+aes_gcm_tp[i].ctlen, aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen) == 0))
		{
			printf("gcm encrypt ok\n");
			printf("ciphertext...\n");
			for(j=0; j<aes_gcm_tp[i].ctlen; j++)
			{
				printf("0x%x\n", out[j]);
			}
			printf("tag...\n");
			for(j=0; j<aes_gcm_tp[i].taglen; j++)
			{
				printf("0x%x\n", *(uint8_t *)(out+aes_gcm_tp[i].ctlen + j));
			}
		#if 0
			printf("golden ciphertext	computed ciphertext\n\r");
			for(j=0; j<aes_gcm_tp[i].ctlen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].ct + j), out[j]);
			}

			printf("golden tag	computed tag\n\r");
			for(j=0; j<aes_gcm_tp[i].taglen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].tag + j), *(uint8_t *)(out+aes_gcm_tp[i].ctlen + j));
			}
		#endif
		}
		else
		{
			printf("gcm encrypt fail\n");
			printf("golden ciphertext	computed ciphertext:\n\r");
			for(j=0; j<aes_gcm_tp[i].ctlen; j++)
			{
				printf("0x%x 0x%x\n", *(uint8_t *)(aes_gcm_tp[i].ct + j), out[j]);
			}

			printf("golden tag	computed tag\n\r");
			for(j=0; j<aes_gcm_tp[i].taglen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].tag + j), *(uint8_t *)(out+aes_gcm_tp[i].ctlen + j));
			}
		}
	}
#endif

#if 1
	printf("GCM_DECRYPT......\n");

	for(i=5; i<ntests; i++)
	{
		/* aes gcm test */
		socket_aes_gcm_cipher(aes_gcm_tp[i].key, aes_gcm_tp[i].keybits,
							ALG_OP_DECRYPT,
							aes_gcm_tp[i].ct, aes_gcm_tp[i].ctlen,
							aes_gcm_tp[i].aad, aes_gcm_tp[i].aadlen, 
							aes_gcm_tp[i].iv, aes_gcm_tp[i].ivlen,
							aes_gcm_tp[i].tag, aes_gcm_tp[i].taglen,
							out);

		printf("Case %d: ctlen %d, aadlen %d, ivlen %d\n\r", i+1, aes_gcm_tp[i].ctlen, aes_gcm_tp[i].aadlen, aes_gcm_tp[i].ivlen);

		if(memcmp(out, aes_gcm_tp[i].pt, aes_gcm_tp[i].ptlen) == 0)
		{
			printf("gcm decrypt ok\n");
			for(j=0; j<aes_gcm_tp[i].ptlen; j++)
			{
				printf("0x%x\n", out[j]);
			}
		#if 0
			printf("golden plaintext	computed plaintext\n\r");
			for(j=0; j<aes_gcm_tp[i].ptlen; j++)
			{
				printf("0x%x	0x%x\n", *(uint8_t *)(aes_gcm_tp[i].pt + j), out[j]);
			}
		#endif
		}
		else
		{
			printf("gcm decrypt fail\n");
			printf("golden plaintext	computed plaintext\n\r");
			for(j=0; j<aes_gcm_tp[i].ptlen; j++)
			{
				printf("0x%x 0x%x\n", *(uint8_t *)(aes_gcm_tp[i].pt + j), out[j]);
			}
		}
	}
#endif

    return 0;
}

static void show_help(void)
{
	printf("\
Usage: ./crypto_demo [-ht] ...\n\
    -h  display help\n\
    -t  crypto type: gcm/hash/rsa\n");
}

int main(int argc, char *argv[])
{
	int ret = 0;
	int opt;
	char *crypto_type;

	if(argc <= 1) {
		printf("Input param error!\n");
		show_help();
		exit(-1);
	}

	while((opt = getopt(argc, argv, "ht:")) != -1)
	{
		switch(opt)
		{
			case 't':
				crypto_type = optarg;
				break;
			case 'h':
				show_help();
				exit(0);
			case '?':
				break;
		}
	}

	if(strcmp(crypto_type, "gcm") == 0)
		ret = do_aes_gcm();
	else if(strcmp(crypto_type, "hash") == 0)
		ret = do_hash();
	else if(strcmp(crypto_type, "rsa") == 0)
		ret = do_rsa();
	else
		printf("Crypto type input error!\n");

	if(ret<0) {
		printf("Crypto computing error!\n");
		return ret;
	}

    return 0;
}